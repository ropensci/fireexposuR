---
output: github_document
editor_options: 
  markdown: 
    wrap: 80
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# fireexposuR

<!-- badges: start -->
[![Project Status: WIP â€“ Initial development is in progress, but there has not yet been a stable, usable release suitable for the public.](https://www.repostatus.org/badges/latest/wip.svg)](https://www.repostatus.org/#wip)

<!-- badges: end -->

The goal of fireexposuR is to provide a standardized and accessible platform for
the computation and analysis of wildfire exposure. Wildfire exposure assessments
are a decision support tool in wildfire management and can be applied for
multiple temporal horizons and spatial extents. This package automates the
methods previously documented in a series of scientific publications. The
functions in this package require the pre-preparation of data; an accompanying
paper details suggestions for data acquisition and preparation in accordance
with various budget limitations and user experience levels. This initial release
of the package provides a collection of functions that assist users with
conducting wildfire exposure and directional vulnerability assessments for
values and landscapes, and includes methods for validating the metric for an
area of interest. Outputs from the functions include spatial data, tables,
graphics, and maps that can be further analyzed or modified directly in R or
exported for use in other applications.

## Installation

You can install the development version of fireexposuR from
[GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("heyairf/fireexposuR")
```

## Usage example

This is a basic example which shows a workflow to assess wildfire exposure to a
community.

### Data preperation

First, some example data will be generated for a make-believe town:

```{r data}
library(terra)
# generate example hazard data -----------------------------
set.seed(0)
e <- c(45,55,495,505) * 10000
r <- rast(resolution = 100, extent = ext(e))
values(r) <- sample(c(0,1), ncell(r), replace = TRUE)
crs(r) <- "EPSG:32608"
r <- sieve(r, threshold = 50, directions = 4)
haz <- sieve(r, threshold = 500, directions = 4)
# generate example AOI polygon -----------------------------
filepath <- "extdata/builtsimpleexamplegeom.csv"
g <- read.csv(system.file(filepath, package = "fireexposuR"))
m <- as.matrix(g)
aoi <- vect(m, "polygons", crs = haz)
# generate example point values within polygon -------------
pts <- spatSample(aoi, 200)
# ----------------------------------------------------------
```

This example data represents the sort of data that would be pre-prepared by a
user for the assessment.

#### Hazard data

The `haz` layer is a binary raster that represents wildland fuels that are able
to generate long-range embers up to a transmission distance of 500 meters:

```{r hazardvis, echo = FALSE}
plot(haz)
```

#### Area of interest and values data

The `aoi` layer is a polygon representing the built environment of our made up
town. The `pts` feature represents the centriods of homes and structures within
the community.

```{r aoivis, echo = FALSE}
plot(aoi)
plot(pts, add = T)
```

### Compute exposure

Now, we will use the hazard data to compute the exposure to long-range ember
transmission. 

```{r exposureexample}
library(fireexposuR)
exp <- exposure(haz, tdist = "l")
```

### Visualize exposure

Once we have an exposure raster the rest of the package functions can be used to
visualize it in different ways. For a landscape, we can map exposure with a 
continuous scale with `mapexpcont()`:

```{r maplandscape}
mapexpcont(exp)
```

We can also see how that exposure is distributed within the built environment
with exposure classifications in an area of interest with `mapexpclass()`. 

Note: our imaginary town is in the middle of the Pacific Ocean so the base map 
does not provide further reference.

```{r maplocal}
mapexpclass(exp, classify = "local", aoi)
```

This map gives us a better understanding of areas of the town that could be
fire entry points. We can also summarize the area with `summexp()` if we want
to know the proportional distributions of each class. 

```{r summlocal}
summexp(exp, classify = "local", aoi)
```

We also have data for the values within the built environment, for which we can 
map or summarize in a table as well.

```{r mapvalues}
# map the values
extractexp(exp, pts, classify = "local", map = TRUE)
# summary table 
extractexp(exp, pts, classify = "local", summary = TRUE)

```

With this information, the community has now identified 12 structures that are 
extremely exposed to long-range embers from the landscape in the northwest of 
the community. This could be a potential area to prioritize wildfire mitigation
strategies.

#### Directional vulnerability

Our make believe town may also wish to assess the directional vulnerability 
to wildfire towards their community. This assessment identifies linear 
pathways of exposure from the landscape toward a value. 

Note: our imaginary town is in the middle of the Pacific Ocean so the base map 
does not provide further reference.

```{r mapdir}
direxp(exp, aoi, map = TRUE)

```

Now we can see that although the northwest corner of the town is a potential 
entry point, the pathway to that location is only viable from 5 kilometers out. 
The southeast pathway might be a more concerning pathway because it covers the 
full 15 kilometers. Depending on local knowledge, this assessment could identify
further areas of concern. For example, if the region has consistent patterns of 
southwest winds it may be a priority area for fuel reduction treatments. Or 
perhaps there is a popular outdoor recreation area to the northwest close to the
community, in which case the shorter pathway might be more concerning if there 
is increased human ignition potential in that area. 

